function toggleChat() {
    $('.card').slideToggle(400, function() { $('.chevron').toggleClass('flipped'); });
    if (localStorage.getItem('chatstate')) {
        localStorage.removeItem('chatstate');
        ga('send', 'event', 'Chatbot', 'toggle', 'open');
    } else {
        localStorage.setItem('chatstate', 'minimized')
        ga('send', 'event', 'Chatbot', 'toggle', 'close');
    }
}

function resetChatbot() {
    chatbot_submitted = false;
    // delete the entire convForm generated by the plugin from the page
    $('#chat').remove();

    $('#chat-wrapper').append($chatbotForm);
    $chatbotForm = $('#chat').clone(true);

    // reset the form
    $('#chatbot_form').trigger("reset");

    // call the convForm function again
    convForm = $('.my-conv-form-wrapper').convform({
        placeHolder: "Write your message...",
        typeInputUi: 'input'
    });
    toggleChat();
}

var $chatbotForm;
$(document).ready(function() {
    $chatbotForm = $('#chat').clone(true);

    var convForm = $('.my-conv-form-wrapper').convform({
        placeHolder: "Write your message...",
        typeInputUi: 'input'
    });

    if (localStorage.getItem('chatstate') && localStorage.getItem('chatstate') == 'minimized') {
        toggleChat();
    }

    // Toggle chat window
    $(document).on('click', '#chathead', function() {
        toggleChat();
    });
});

function botga(currentState) {
    ga('send', 'event', 'Chatbot', 'interaction', JSON.stringify(currentState.answers));
}
